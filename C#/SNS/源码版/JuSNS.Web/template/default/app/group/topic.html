#parse("_head.html")
<div id="snsmenu">
#parse("_menu.html")
</div>
<script type="text/javascript" src="$webpath/library/xmleditor/xheditor-zh-cn.min.js"></script>
<div id="snsbody">
    <div id="snshead"><span class="l" style="width:590px;padding-bottom:10px;"></span><span class="r"><input id="kwd" name="kwd" value="#if($kwd)$kwd#else搜索话题#end" type="text" class="f-text w100" onclick="this.value=''" /> <input id="Button1" type="button" value="搜索" class="btn_gray2" onclick="search('grouptopic','$gid')" /></span></div>

    <div id="snsbody-all">
          <div class="grouplist">
                <div class="images l">
                    <img src="$portrait" onerror="this.src='$templatepath/images/nopic.gif'" />
                </div>
                <div class="bulletin">
                    <h3>$GroupName</h3>
                    <div class="info">$Bulletin</div>
                </div>
          </div>
      <div class="itemmenu">
        <ul>
            <li><a href="$webpath/app/group/group$exname?gid=$gid">$groupname首页</a></li>
            <li class="current"><a href="$webpath/app/group/list$exname?gid=$gid">话题区($topiccount)</a></li>
            <!--<li><a href="ative$exname?gid=$gid">活动($ativecount)</a></li>-->
            <li><a href="$webpath/app/group/album$exname?gid=$gid">相册($albumcount)</a></li>
            <li><a href="$webpath/app/group/files$exname?gid=$gid">文件共享($filescount)</a></li>
            <li><a href="$webpath/app/group/member$exname?gid=$gid">所有成员($membercount)</a></li>
            <li><a href="$webpath/app/group/list$exname?gid=$gid&q=best">精华区</a></li>
            <li class="new"><a href="$webpath/app/group/post$exname?gid=$gid" class="newitem">发表话题</a></li> 
        </ul>
        
    </div>
    <div class="topics">
        <div class="tophdtitle"> <span class="l">» $title &nbsp; $showop</span><a class="a-report r" href="$reporturl" title="不良信息举报" target="_blank"></a> <a href="javascript:;" onclick="sharetofriend('topic',$tid,$uid,'帖子：$title')" class="a-share">分享</a></div>
        <div class="aa center images"><a href="$spaceurl"><img src="$headpic" /><br />$truename</a></div>
        <div class="bb">
            <div class="l time">$time &nbsp;&nbsp; IP:$ip</div>
            <div class="r time">楼主</div>
            <p class="topiccontent">$content</p>
        </div>
        <div class="clearpix"></div>
        <ul>
            #foreach($info in $infolist)
            <li style="margin:8px 0;padding:5px 0;" id="param_$info.id">
                <div class="aa center images"><a href="$info.spaceurl"><img src="$info.headpic" /><br />$info.truename</a></div>
                <div class="bb" style="margin:3px 0;_width:680px;">
                    <div class="l time">$info.time &nbsp;&nbsp; IP:$info.ip</div>
                    <div class="r time">$info.showop &nbsp; $info.foolnumber楼</div>
                    <p  class="topiccontent" id="qcontent_$info.id">$info.content</p>
                     <div class="pitem" style="display:none;" id="editreplay_$info.id">
                    <textarea name="cont_$info.id" id="cont_$info.id" style="width:88%;height:120px;" class="xheditor-simple {upBtnText:'上传',upMultiple:5,upLinkUrl:'$editfile',upImgUrl:'$edit_pic',skin:'$editskin'}">$info.content</textarea>
                    <p><input id="Button2" type="button" value="修改" class="btn_blue4" onclick="javascript:savereplaydata($info.id,$info.userid,$uid)" /></p>
                </div>
                </div>
               
            </li>
            #end
                <div class="pages">$pagelist</div>
        </ul>
    </div>
    <div class="line"></div>
    <form id="form1" name="form1" action="" method="post">
    #if($uid>0)
    <div class="pitem">
        <em><strong>回复帖子</strong></em>
            <textarea runat="server" name="txtcontent"  id="txtcontent" class="xheditor-simple {upBtnText:'上传',upMultiple:5,upLinkUrl:'$editfile',upImgUrl:'$edit_pic',skin:'$editskin'}" id="txtcontent" style="width:81%;height:300px"></textarea>
        <input id="userid" name="userid" value="$userid" type="hidden" />
    </div>
    <div class="pitem">
        <em>&nbsp;</em><input id="Submit1" type="button" value="提交回复" class="btn_blue4" onclick="javascript:saveTopicdata($tid,$gid,$userid)" />
        
    </div>
    #else
    <div class="pitem reshow">
        <em>&nbsp;</em>登录后才能回复
    </div>
    #end
    </form>
    </div>
</div>
<script type="text/javascript">
    function savereplaydata(tid,userid,uid)
    {
        var content = jQuery("#cont_"+tid).val();
          jQuery.get(ajaxUrl, { action:"EditTopicAjax",content:content, userid:userid,tid:tid,uid:uid, param:Math.random() }, 
          function(msg)
          {
                switch(msg)
                {
                   case "1":
                        showRightResult("编辑成功");
                        jQuery("#qcontent_"+tid).html(content);
                        jQuery("#editreplay_"+tid).hide()
                       break;
                   default:
                        showErrorResult("编辑失败");
                       break;
                }
          }
        );          
    }
    function showedits(tid)
    {
        jQuery("#editreplay_"+tid).toggle()
    }
    function saveTopicdata(tid,gid,userid)
    {
            var content=jQuery("#txtcontent").val();
            if(content=="")
            {
                showErrorResult("回复内容必须填写");return;
            }
            else
            {
                loading();
            }
            jQuery.post("$webpath/app/group/topic"+ExName+"?tid="+tid+"&gid="+gid+"&userid="+userid+"", { txtcontent:content, tid:tid,gid:gid,userid:userid, param:Math.random() }, 
          function(msg)
          {
                switch(msg)
                {
                    case "-2":
                        showErrorResult("您不是本群成员，不能发言。");
                        break;
                    case "-1":
                        showErrorResult("登录后才能回复帖子");
                        break;
                    case "0":
                        showErrorResult("回复失败");
                        break;
                    case "1":
                        showRightResult("回复成功");
                         setTimeout(function() 
                         {
                            window.location.href=location.href;
                          }, 800);
                        
                        break;
                    case "2":
                        showRightResult("回复成功，管理员审核后显示。");
                         setTimeout(function() 
                         {
                            window.location.href=location.href;
                          }, 800);
                        break;
                }
                loadingclear();
          }
        );          
    }
</script>
#parse("_foot.html")